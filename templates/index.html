<!DOCTYPE html>
<html>

<head>
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/showdown.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/highlight.min.js') }}"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/atom-one-dark-reasonable.min.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='assets/favicon.ico') }}">
    <script type="module" src="{{ url_for('static', filename='js/script.js') }}"></script>
    <title>AI Multi-tool</title>
</head>

<body>
    <div class="tab">
        <button id="generationTab" class="tablinks">Image</button>
        <button id="gridViewTab" class="tablinks">Grid View</button>
        <button id="chatTab" class="tablinks">Chat</button>
        <button id="promptsTab" class="tablinks">Prompts</button>

        {% if 'username' in session %}
        <div class="user-info">
            <p>Logged in as: {{ session['username'] }} <a href="{{ url_for('logout') }}">Logout</a></p>
        </div>
        {% endif %}
    </div>

    <div id="Generation" class="tabcontent">
        <form id="prompt-form">
            <label for="provider">Select Provider:</label>
            <select name="provider" id="provider">
                <option value="openai">OpenAI (GPT Image 1)</option>
                <option value="stabilityai">Stability AI (Stable Diffusion 3)</option>
                <option value="novelai">NovelAI</option>
            </select><br><br>

            <label for="size" class="openai novelai">Select Size:</label>
            <select name="size" id="size" class="openai novelai">
                <option value="1024x1536" class="openai">1024x1536 (Portrait)</option>
                <option value="1024x1024" class="openai">1024x1024 (Square)</option>
                <option value="1536x1024" class="openai">1536x1024 (Landscape)</option>
                <option value="832x1216" class="novelai">832x1216 (Portrait)</option>
                <option value="640x1600" class="novelai">640x1600 (Portrait Tall)</option>
                <option value="1024x1024" class="novelai">1024x1024 (Square)</option>
                <option value="1216x832" class="novelai">1216x832 (Landscape)</option>
                <option value="1600x640" class="novelai">640x1600 (Landscape Wide)</option>
            </select><br class="openai"><br class="openai novelai">

            <label for="aspect_ratio" class="stabilityai">Aspect Ratio:</label>
            <select name="aspect_ratio" id="aspect_ratio" class="stabilityai">
                <option value="1:1">1:1 (Square)</option>
                <option value="16:9">16:9 (Landscape)</option>
                <option value="21:9">21:9 (Landscape)</option>
                <option value="3:2">3:2 (Landscape)</option>
                <option value="5:4">5:4 (Landscape)</option>
                <option value="2:3">2:3 (Portrait)</option>
                <option value="4:5">4:5 (Portrait)</option>
                <option value="9:16">9:16 (Portrait)</option>
                <option value="9:21">9:21 (Portrait)</option>
            </select><br class="stabilityai"><br class="stabilityai">

            <label for="quality" class="openai">Select Quality:</label>
            <select name="quality" id="quality" class="openai">
                <option value="high">high</option>
                <option value="medium">medium</option>
                <option value="low">low</option>
            </select><br class="openai"><br class="openai">

            <br class="openai"><br class="openai">

            <label for="seed" class="stabilityai novelai openai">Select Seed (0 means random):</label>
            <input name="seed" id="seed" type="number" value="0" min="0" max="18446744073709551615" step="1"
                class="stabilityai novelai openai" />
            <div class="prompt-checkbox-group stabilityai novelai">
                <input type="checkbox" id="upscale" class="prompt-checkbox stabilityai novelai" name="upscale">
                <label class="prompt-checkbox-label stabilityai novelai" for="upscale" id="upscale">Upscale</label>
            </div>
            <div class="prompt-checkbox-group novelai">
                <input type="checkbox" id="variety" class="prompt-checkbox novelai" name="variety">
                <label class="prompt-checkbox-label novelai" for="variety">Variety Mode</label>
            </div>
            <br class="stabilityai"><br class="stabilityai novelai">
            <!-- Advanced Options Block -->
            <div class="advanced-options">
                <div class="advanced-header" id="advanced-toggle">
                    <span>Show Advanced Options ‚Æü</span>
                </div>
                <div id="advanced-dropdown" class="advanced-dropdown" style="display: none;">
                    <div class="advanced-input-group">
                        <input type="checkbox" id="advanced-generate-grid" name="advanced-generate-grid">
                        <label for="advanced-generate-grid">Generate Grid</label>
                        <div class="advanced-input-container" style="display: none;">
                            <input type="text" id="grid-prompt-file" name="grid-prompt-file" placeholder="file_name"
                                disabled>
                        </div>
                    </div>
                </div>
            </div>
            <!-- TODO: Need to fix, the Stability AI max length is 10,000 characters, not 4000 -->
            <div>Enter Prompt:</div>
            <textarea name="prompt" id="prompt" maxlength="4000" rows="8" cols="50" spellcheck="true"></textarea>
            <div id="charCount">0 / 4000</div>
            <div class="stabilityai novelai">Enter Negative Prompt:</div>
            <textarea name="negative_prompt" id="negative_prompt" class="stabilityai novelai negativeprompt"
                maxlength="4000" rows="8" cols="50" spellcheck="true"></textarea>

            <!-- Character Prompt Interface for NovelAI -->
            <div id="character-prompt-section" class="novelai character-prompt-section" style="display: none;">
                <div class="character-prompt-header">
                    <h3>Character Prompts</h3>
                    <div class="character-controls">
                        <button type="button" id="add-character-btn" class="character-btn">Add Character</button>
                        <span id="character-count">0 characters</span>
                    </div>
                </div>



                <div id="character-prompts-container">
                    <!-- Character prompt sections will be dynamically added here -->
                </div>
            </div>
            <div class="prompt-checkbox-group openai">
                <input type="checkbox" id="add-follow-prompt" class="prompt-checkbox openai" name="add-follow-prompt">
                <label class="prompt-checkbox-label openai" for="add-follow-prompt" id="add-follow-prompt">Strictly
                    follow prompt</label>
            </div>

            <!-- Inpainting Section -->
            <div id="inpainting-section" class="inpainting-section" style="display: none;">
                <div class="inpainting-header">
                    <h3>üé® Inpainting Mode</h3>
                    <button type="button" id="clear-inpainting-btn" class="secondary-button">Clear Inpainting</button>
                </div>

                <div class="inpainting-info">
                    <div class="inpainting-image-info">
                        <strong>Base Image:</strong> <span id="inpainting-image-name">None selected</span>
                    </div>
                    <div class="inpainting-mask-info">
                        <strong>Mask:</strong> <span id="inpainting-mask-status">No mask created</span>
                    </div>
                </div>

                <div class="inpainting-preview">
                    <div class="inpainting-preview-container">
                        <img id="inpainting-base-preview" class="inpainting-preview-image" style="display: none;"
                            alt="Base image preview">
                        <img id="inpainting-mask-preview" class="inpainting-preview-image" style="display: none;"
                            alt="Mask preview">
                    </div>
                </div>

                <!-- Hidden fields for inpainting data -->
                <input type="hidden" id="inpainting-base-image" name="base_image_path" value="">
                <input type="hidden" id="inpainting-mask-path" name="mask_path" value="">
                <input type="hidden" id="inpainting-operation" name="operation" value="">
            </div>

            <br><br>
            <input class="submit-button" type="submit" value="Generate Image" id="generate-submit-btn">
            <img id="loading-spinner" width="80" height="80"
                src="{{ url_for('static', filename='assets/Chunk-4s-200px.png') }}">
        </form>

        <!--Filled in at runtime see result-section.html template-->
        <div id="result-section"></div>
    </div>
    <div id="GridView" class="tabcontent">
        <div class="image-grid">
            <!-- Images will be loaded here -->
        </div>
        <!-- Grid view modal for full size image display with nav buttons -->
        <div id="grid-image-modal" style="display:none" class="modal grid-modal">
            <span id="grid-image-close" class="close">&times;</span>
            <button id="grid-prev" class="grid-nav-btn">&lsaquo;</button>
            <div class="modal-content-wrapper">
                <img class="modal-content" id="grid-modal-image">
                <div class="info-panel" id="grid-info-panel">
                    <!-- Populated in TypeScript at runtime -->
                </div>
            </div>
            <button id="grid-next" class="grid-nav-btn">&rsaquo;</button>
        </div>
        <button class="grid-nav-buttons" id="firstGrid">&laquo;</button>
        <button class="grid-nav-buttons" id="previousGrid">&nbsp;&lsaquo;&nbsp;</button>
        <button class="grid-nav-buttons" id="nextGrid">&nbsp;&rsaquo;&nbsp;</button>
        <button class="grid-nav-buttons" id="lastGrid">&raquo;</button>
        <div id="gridPageNum">Page 1/X</div>
    </div>
    <div id="Chat" class="tabcontent">
        <div class="chat-container">
            <div id="sidebar" class="sidebar">
                <div id="conversations-list"><!-- Populated in TypeScript at runtime --></div>
            </div>
            <div class="chat-content">
                <!-- Floating Agent Preset Controls -->
                <div class="floating-agent-controls" id="floating-agent-controls">
                    <!-- Compact Header -->
                    <div class="preset-header" id="preset-header">
                        <div class="preset-summary">
                            <span class="current-agent" id="current-agent-display">Default Assistant</span>
                            <span class="current-reasoning" id="current-reasoning-display">Medium</span>
                        </div>
                        <div class="preset-header-actions">
                            <button id="manage-presets-btn" class="manage-presets-btn" title="Manage Agent Presets">‚öôÔ∏è</button>
                            <button id="toggle-preset-controls" class="toggle-preset-btn" title="Expand Agent Controls">‚Æü</button>
                        </div>
                    </div>
                    
                    <!-- Expandable Controls -->
                    <div class="preset-controls-expanded" id="preset-controls-expanded" style="display: none;">
                        <div class="preset-selector-group">
                            <label for="agent-preset-selector">Agent:</label>
                            <select id="agent-preset-selector" class="preset-selector">
                                <option value="">Default Assistant</option>
                            </select>
                        </div>
                        <div class="reasoning-selector-group">
                            <label for="reasoning-level-selector">Reasoning:</label>
                            <select id="reasoning-level-selector" class="reasoning-selector">
                                <option value="">Use Preset Default</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Floating Status Messages for Agent Presets -->
                <div id="agent-preset-success" class="floating-success-message" style="display: none;"></div>
                <div id="agent-preset-error" class="floating-error-message" style="display: none;"></div>
                
                <div id="chat-history"><!-- Populated in TypeScript at runtime --></div>
                <div id="chat-current-status">Awaiting Input...</div>
                <div class="input-area">
                    <div class="input-controls">
                        <div class="reasoning-level-indicator" id="reasoning-level-indicator" style="display: none;">
                            <span class="indicator-label">Reasoning Override:</span>
                            <span class="indicator-value" id="reasoning-override-display"></span>
                            <button class="clear-override-btn" id="clear-reasoning-override" title="Clear reasoning level override">√ó</button>
                        </div>
                    </div>
                    <textarea id="chat-input" placeholder="Type your message here..."></textarea>
                    <button id="send-chat">Send</button>
                </div>
            </div>
        </div>

    </div>
    <div id="PromptFiles" class="tabcontent">
        <div class="prompt-files-container">
            <div class="prompt-files-header">
                <h2>Dynamic Prompts</h2>
                <p>Manage your prompt files for dynamic prompt generation. Reference files using __filename__ syntax.
                </p>
                <button id="create-prompt-file-btn" class="primary-button">Create New File</button>
            </div>

            <div class="prompt-files-list">
                <div id="prompt-files-loading" class="loading-message" style="display: none;">
                    Loading prompt files...
                </div>
                <div id="prompt-files-content">
                    <!-- Prompt files will be loaded here -->
                </div>
                <div id="no-prompt-files" class="empty-message" style="display: none;">
                    No prompt files found. Create your first file to get started!
                </div>
            </div>
        </div>

        <!-- Create/Edit Prompt File Modal -->
        <div id="prompt-file-modal" class="modal prompt-file-modal" style="display: none;">
            <div class="modal-content prompt-modal-content">
                <div class="modal-header">
                    <h3 id="prompt-modal-title">Create New Prompt File</h3>
                    <span class="close" id="prompt-modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="prompt-file-name">File Name:</label>
                        <input type="text" id="prompt-file-name" placeholder="colors" class="form-input">
                        <small class="form-help">File extension (.txt) will be added automatically</small>
                    </div>
                    <div class="form-group">
                        <label for="prompt-file-content">Content:</label>
                        <textarea id="prompt-file-content" rows="15" class="form-textarea"
                            placeholder="red&#10;blue&#10;green&#10;yellow&#10;purple"></textarea>
                        <div id="prompt-file-help" class="form-help">
                            <p>Enter one option per line</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="prompt-file-save" class="primary-button">Save</button>
                    <button id="prompt-file-cancel" class="secondary-button">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Reasoning Modal -->
    <div id="reasoning-modal" class="modal reasoning-modal" style="display: none;">
        <div class="modal-content reasoning-modal-content">
            <div class="modal-header">
                <h3>AI Process Details</h3>
                <span class="close" id="reasoning-modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <button class="tab-button active" data-tab="reasoning">Reasoning</button>
                    <button class="tab-button" data-tab="search">Web Searches</button>
                </div>
                <div id="reasoning-loading" class="loading-message">
                    Loading process data...
                </div>
                <div id="reasoning-error" class="error-message" style="display: none;">
                    <!-- Error message will be populated here -->
                </div>
                <div id="reasoning-content" class="tab-content" data-tab="reasoning" style="display: none;">
                    <!-- Reasoning content will be populated here -->
                </div>
                <div id="search-content" class="tab-content" data-tab="search" style="display: none;">
                    <!-- Web search content will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Agent Preset Management Modal -->
    <div id="agent-preset-management-modal" class="modal agent-preset-modal" style="display: none;">
        <div class="modal-content agent-preset-modal-content">
            <div class="modal-header">
                <h3>Manage Agent Presets</h3>
                <span class="close" id="preset-management-modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="preset-management-actions">
                    <button id="create-new-preset-btn" class="primary-button">Create New Preset</button>
                </div>
                
                <div id="preset-list-container">
                    <div id="preset-list-loading" class="loading-message" style="display: none;">
                        Loading presets...
                    </div>
                    <div id="preset-list" class="preset-list">
                        <!-- Preset list will be populated here -->
                    </div>
                    <div id="no-presets-message" class="empty-message" style="display: none;">
                        No custom presets found. Create your first preset to get started!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agent Preset Form Modal -->
    <div id="agent-preset-modal" class="modal agent-preset-modal" style="display: none;">
        <div class="modal-content agent-preset-modal-content">
            <div class="modal-header">
                <h3 id="preset-modal-title">Create New Agent Preset</h3>
                <span class="close" id="preset-modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="preset-form-errors" class="error-message" style="display: none;">
                    <!-- Form validation errors will be displayed here -->
                </div>
                
                <form id="agent-preset-form" class="agent-preset-form">
                    <div class="form-group">
                        <label for="preset-name">Name:</label>
                        <input type="text" id="preset-name" class="form-input" placeholder="My Custom Assistant" maxlength="100" required>
                        <small class="form-help">A descriptive name for your agent preset</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="preset-instructions">Instructions:</label>
                        <textarea id="preset-instructions" class="form-textarea" rows="8" placeholder="You are a helpful assistant that..." maxlength="5000" required></textarea>
                        <small class="form-help">System instructions that define the agent's behavior and personality</small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="preset-model">Model:</label>
                            <select id="preset-model" class="form-select" required>
                                <option value="gpt-5">GPT-5 (Standard)</option>
                                <option value="gpt-5-mini">GPT-5 Mini (Fast)</option>
                                <option value="gpt-5-pro">GPT-5 Pro (Advanced)</option>
                            </select>
                            <small class="form-help">AI model to use for this preset</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="preset-reasoning-level">Default Reasoning Level:</label>
                            <select id="preset-reasoning-level" class="form-select" required>
                                <option value="high">High (Detailed Analysis)</option>
                                <option value="medium">Medium (Balanced)</option>
                                <option value="low">Low (Quick Response)</option>
                            </select>
                            <small class="form-help">Default reasoning intensity for this preset</small>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="preset-modal-save" class="primary-button">Create Preset</button>
                <button id="preset-modal-delete" class="danger-button" style="display: none;">Delete Preset</button>
                <button id="preset-modal-cancel" class="secondary-button">Cancel</button>
            </div>
        </div>
    </div>

    <a href="https://loading.io/icon/" target="_blank" rel="noopener noreferrer">Loading icon 'chunk' from
        loading.io</a>
</body>

</html>