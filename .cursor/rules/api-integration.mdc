# API Integration Guidelines

## Supported Providers
- **OpenAI**: High-quality image generation using `gpt-image-1` model with dimension validation
- **Stability AI**: Stable Diffusion 3.5 with aspect ratio control
- **NovelAI**: Anime-style generation with character prompts and upscaling support

## Operations Supported
- **Generate**: Text-to-image generation (all providers)
- **Inpaint**: Masked image editing (OpenAI, NovelAI)  
- **Img2Img**: Image-to-image transformation (NovelAI only)

## Unified API Endpoint
- `POST /image` - Single endpoint handling all providers and operations
- Request validation through `image_models.py` with strict typing
- Provider-specific parameter routing and validation
- Consistent JSON response format with `success`, `image_path`, `metadata` fields

## Error Handling
- Handle API rate limits gracefully
- Implement retry logic for transient failures
- Return structured error responses
- Log API usage for monitoring

## File Storage
- Generated images: `static/images/{username}/{sequence}-{prompt}.png`
- Thumbnails: `static/images/{username}/{sequence}-{prompt}.thumb.jpg`
- Metadata preservation in image files
- User-specific directory structure

## Security
- API keys stored in environment variables
- Never log or expose API keys
- Validate user input before API calls
- Implement request sanitization

## Performance
- Respect provider-specific rate limits
- Implement request queuing if needed
- Cache frequently accessed data
- Monitor API usage and costs
description:
globs:
alwaysApply: false
---
